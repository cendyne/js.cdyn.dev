!function(){const t=function(t){const e=t=>{let e=0;for(let a=0;a<t.length;a++){const o=t[a];e=83*e+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~".indexOf(o)}return e},a=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},o=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.round(12.92*e*255+.5):Math.round(255*(1.055*Math.pow(e,1/2.4)-.055)+.5)},r=(t,e)=>(t<0?-1:1)*Math.pow(Math.abs(t),e),l=t=>{const e=t>>8&255,o=255&t;return[a(t>>16),a(e),a(o)]},s=(t,e)=>{const a=Math.floor(t/361),o=Math.floor(t/19)%19,l=t%19;return[r((a-9)/9,2)*e,r((o-9)/9,2)*e,r((l-9)/9,2)*e]};return t.decodePromise=(e,a,o,r=1)=>new Promise(((l,s)=>{l(t.decode(e,a,o,r))})),t.decode=(t,a,r,n=1)=>{(t=>{if(!t||t.length<6)throw new Error("The blurhash string must be at least 6 characters");const a=e(t[0]),o=Math.floor(a/9)+1,r=a%9+1;if(t.length!==4+2*r*o)throw new Error(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*o}`)})(t),n|=1;const h=e(t[0]),i=Math.floor(h/9)+1,d=h%9+1,u=(e(t[1])+1)/166,c=new Array(d*i);for(let a=0;a<c.length;a++)if(0===a){const o=e(t.substring(2,6));c[a]=l(o)}else{const o=e(t.substring(4+2*a,6+2*a));c[a]=s(o,u*n)}const g=4*a,m=new Uint8ClampedArray(g*r);for(let t=0;t<r;t++)for(let e=0;e<a;e++){let l=0,s=0,n=0;for(let o=0;o<i;o++)for(let h=0;h<d;h++){const i=Math.cos(Math.PI*e*h/a)*Math.cos(Math.PI*t*o/r);let u=c[h+o*d];l+=u[0]*i,s+=u[1]*i,n+=u[2]*i}let h=o(l),u=o(s),f=o(n);m[4*e+0+t*g]=h,m[4*e+1+t*g]=u,m[4*e+2+t*g]=f,m[4*e+3+t*g]=255}return m},t}({});for(let e of document.getElementsByClassName("blurhash-parent")){let a=e.querySelector("img");const o=e.dataset.blurhash;try{const r=Number.parseInt(e.dataset.width),l=Number.parseInt(e.dataset.height);if(a&&o&&r&&l){const s=e.getBoundingClientRect();let n={loaded:!1,blurHashImage:null,width:r,height:l,classes:[]};for(let t of a.classList.values())n.classes.push(t);if(a.classList.add("blurhash-actual-image"),ratio=window.devicePixelRatio||1,r>s.width?(n.width=Math.floor(s.width)/ratio,n.height=Math.floor(l/r*s.width)/ratio):(n.width/=ratio,n.height/=ratio),a.complete){e.classList.add("blurhash-loaded");continue}e.classList.add("blurhash-unloaded"),a.addEventListener("load",(()=>{n.loaded=!0,e.classList.add("blurhash-loaded"),e.classList.remove("blurhash-unloaded"),e.style.minWidth=null,e.style.minHeight=null,e.style.backgroundImage=null,e.style.backgroundSize=null,n.blurHashImage=!1})),setTimeout((()=>{requestAnimationFrame((()=>{const a=t.decode(o,64,64);if(a.length<=0)return;if(n.loaded)return;e.style.minWidth=`${n.width}px`,e.style.minHeight=`${n.height}px`;const r=document.createElement("canvas");let l=r.getContext("2d");r.width=64,r.height=64,l.width=64,l.height=64,l.putImageData(new ImageData(a,64,64),0,0),requestAnimationFrame((()=>{n.loaded||(e.style.backgroundImage=`url(${r.toDataURL()})`,e.style.backgroundSize="cover",n.blurHashImage=!0)}))}))}),30)}}catch(t){console&&console.error&&console.error(t)}}}();
